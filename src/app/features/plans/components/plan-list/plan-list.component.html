<txg-main-layout title="Training Plans" [loadingSignal]="isLoading">
  <div class="txg-plan-list-container p-4 md:p-6 pb-20">
    @if (isLoading() && plans().length === 0) {
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        @for (item of [1, 2]; track item) {
          <txg-plan-card-skeleton></txg-plan-card-skeleton>
        }
      </div>
    } @else if (error()) {
      <div class="flex justify-center items-center min-h-[calc(100vh-200px)]">
        <div class="flex flex-col items-center justify-center text-center p-10 bg-red-50 dark:bg-red-900/30 rounded-lg max-w-lg">
          <mat-icon class="text-red-500 dark:text-red-400 !text-5xl mb-4">error_outline</mat-icon>
          <p class="text-xl font-medium text-red-700 dark:text-red-300 mb-2">An Error Occurred</p>
          <p class="text-red-600 dark:text-red-400 mb-6">{{ error() }}</p>
          <button mat-stroked-button color="warn" (click)="loadPlans()">Try Again</button>
        </div>
      </div>
    } @else if (!isLoading() && plans().length === 0 && !error()) {
      <div class="flex justify-center items-center min-h-[calc(100vh-200px)]">
        <txg-plan-list-empty
          (buttonClick)="openCreatePlanDialog()">
        </txg-plan-list-empty>
      </div>
    } @else if (plans().length > 0) {
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        @for (plan of plans(); track plan.id) {
          <txg-plan-card [plan]="plan" (planClicked)="navigateToPlanDetails($event)"></txg-plan-card>
        }
      </div>

      <!-- Sentinel for Intersection Observer -->
      <div #sentinel class="h-10"></div>

      <!-- Loading more indicator (optional) -->
      @if (isLoading() && plans().length > 0) {
        <div class="flex justify-center items-center mt-6">
          <mat-progress-spinner mode="indeterminate" diameter="30"></mat-progress-spinner>
          <span class="ml-2 text-gray-600 dark:text-gray-300">Loading more plans...</span>
        </div>
      }
    } @else {
      <div class="flex justify-center items-center min-h-[calc(100vh-200px)]">
        <div class="flex flex-col items-center justify-center text-center p-10">
          <p>Something went wrong. Please try refreshing the page.</p>
        </div>
      </div>
    }
  </div>

  @if (plans().length > 0) {
    <button mat-fab
            color="primary"
            (click)="openCreatePlanDialog()"
            matTooltip="Add new training plan"
            class="!fixed bottom-[5.5rem] right-6 z-50">
      <mat-icon>add</mat-icon>
    </button>
  }
</txg-main-layout>
